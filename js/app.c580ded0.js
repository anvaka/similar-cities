(function(t){function e(e){for(var i,r,s=e[0],l=e[1],c=e[2],u=0,f=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&f.push(o[r][0]),o[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);d&&d(e);while(f.length)f.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(i=!1)}i&&(a.splice(e--,1),t=r(r.s=n[0]))}return t}var i={},o={app:0},a=[];function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var d=l;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";n("85ec")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[t.loaded?t._e():n("div",{staticClass:"loading"},[t._v(" Downloading the graph of cities... ")]),t.loaded?n("div",{staticClass:"sidebar"},[t.details?t._e():n("div",[n("div",{staticClass:"control-panel"},[n("a",{staticClass:"btn-header",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.listVisible=!t.listVisible}}},[t._v(t._s(t.listToggleHeader))])]),t.listVisible?n("div",{staticClass:"list-container"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.filterValue,expression:"filterValue"}],staticClass:"filter-box",attrs:{type:"search",placeholder:"Filter"},domProps:{value:t.filterValue},on:{input:function(e){e.target.composing||(t.filterValue=e.target.value)}}}),n("virtual-list",{staticStyle:{height:"360px","overflow-y":"auto"},attrs:{"estimate-size":32,"data-key":"id","data-sources":t.filteredNodes,"data-component":t.itemComponent}})],1):t._e(),t.details||t.listVisible?t._e():n("div",{staticClass:"about"},[n("p",[t._v(" Each dot is a city. Cities that have similar road networks are connected by an edge. ")]),t._m(0)])]),t.details?n("div",[n("a",{staticClass:"btn-header",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.details=null}}},[t._v(t._s(t.goBackHeader))]),n("div",[n("p",{staticClass:"main-title",attrs:{title:t.details.main.name}},[t._v(t._s(t.details.main.name))]),n("a",{attrs:{href:t.getLink(t.details.main.id),target:"_blank"}},[n("img",{staticClass:"main-image",attrs:{src:t.details.main.image,alt:t.details.main.name}})])]),t._m(1),n("div",{staticClass:"secondary"},t._l(t.details.related,(function(e,i){return n("div",{key:i,staticClass:"related"},[n("p",{attrs:{title:e.name}},[n("span",{staticClass:"score"},[t._v(t._s(e.score))]),t._v(" "+t._s(e.name))]),n("a",{attrs:{href:t.getLink(e.id),target:"_blank",title:e.name},on:{click:function(n){return t.handleImageClick(e.id,n)}}},[n("img",{staticClass:"related-image",attrs:{src:e.image,alt:e.name}})])])})),0)]):t._e()]):t._e(),n("transition",{attrs:{name:"fade"}},[t.tooltip?n("tooltip",{staticClass:"tooltip",style:{left:t.tooltip.x+"px",top:t.tooltip.y+"px"},attrs:{data:t.tooltip}}):t._e()],1)],1)},a=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",{staticClass:"byline"},[t._v(" Created by "),n("a",{attrs:{href:"https://twitter.com/anvaka"}},[t._v("@anvaka")]),n("a",{staticClass:"more-info",attrs:{href:"https://github.com/anvaka/similar-cities"}},[t._v("more info")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",{staticClass:"info"},[t._v(" City roads below are sorted by decreasing "),n("span",{staticClass:"score"},[t._v("similarity")]),t._v(". ")])}],r=(n("4d63"),n("ac1f"),n("25f0"),n("4de4"),n("466d"),n("b0c0"),n("159b"),n("99af"),n("5530")),s=(n("d3b7"),n("4057"),n("9aeb")),l=n("d4ec"),c=n("bee2"),d=n("262e"),u=n("2caf"),f=function(t){Object(d["a"])(n,t);var e=Object(u["a"])(n);function n(t){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(l["a"])(this,n);var a=Object(s["e"])({gl:t,vertex:"\n    uniform mat4 modelViewProjection;\n    uniform float width;\n    uniform vec2 resolution;\n\n    attribute vec4 color;\n    attribute vec3 from, to;\n    attribute vec2 point;\n\n    varying vec4 vColor;\n    varying vec2 vPoint;\n\n    void main() {\n      vec4 clip0 = modelViewProjection * vec4(from, 1.0);\n      vec4 clip1 = modelViewProjection * vec4(to, 1.0);\n\n      vec2 screen0 = resolution * (0.5 * clip0.xy/clip0.w + 0.5);\n      vec2 screen1 = resolution * (0.5 * clip1.xy/clip1.w + 0.5);\n\n      vec2 xBasis = normalize(screen1 - screen0);\n      vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n\n      // Offset the original points:\n      vec2 pt0 = screen0 + width * point.x * yBasis;\n      vec2 pt1 = screen1 + width * point.x * yBasis;\n\n      vec2 pt = mix(pt0, pt1, point.y);\n      vec4 clip = mix(clip0, clip1, point.y);\n\n      gl_Position = vec4(clip.w * (2.0 * pt/resolution - 1.0), clip.z, clip.w);\n      vColor = color.abgr; // mix(.abgr, aToColor.abgr, aPosition.y);\n    }",fragment:"\n    precision highp float;\n    varying vec4 vColor;\n\n    void main() {\n      gl_FragColor = vColor;\n    }",attributes:{color:new s["a"]},instanced:{point:new s["c"]([-.5,0,-.5,1,.5,1,-.5,0,.5,1,.5,0])}});return i=e.call(this,a),i.width=o.width||2,i}return Object(c["a"])(n,[{key:"clear",value:function(){this.program.setCount(0)}},{key:"draw",value:function(t,e){this.uniforms||(this.uniforms={modelViewProjection:this.modelViewProjection,width:this.width,resolution:[e.width,e.height]}),this.uniforms.resolution[0]=e.width,this.uniforms.resolution[1]=e.height,this.program.draw(this.uniforms)}},{key:"forEachLine",value:function(t){for(var e=this.program.getCount(),n=0;n<e;++n){var i=this.program.get(n),o={x:i.from[0],y:i.from[1],z:i.from[2],color:i.color},a={x:i.to[0],y:i.to[1],z:i.to[2],color:i.color};t(o,a)}}},{key:"getLineColor",value:function(t){var e=this.program.getCount(),n=t?t.color:e>0?this.program.get(0).color:4294967295;return[n>>24&1,n>>16&1,n>>8&1,n>>0&1]}}]),n}(s["b"]),p=function(t){Object(d["a"])(n,t);var e=Object(u["a"])(n);function n(t){Object(l["a"])(this,n);var i=Object(s["e"])({gl:t,vertex:"\n  uniform mat4 modelViewProjection;\n\n  attribute float size;\n  attribute vec3 position;\n  attribute vec4 color;\n\n  attribute vec2 point; // instanced\n\n  varying vec4 vColor;\n  varying vec2 vPoint;\n  void main() {\n    gl_Position = modelViewProjection * vec4(position + vec3(point * size, 0.), 1.0);\n    vColor = color.abgr;\n    vPoint = point;\n  }",fragment:"\n  precision highp float;\n  varying vec4 vColor;\n  varying vec2 vPoint;\n  void main() {\n    float dist = length(vPoint);\n    if (dist >= 0.5) {discard;}\n    gl_FragColor = vColor;\n  }",attributes:{color:new s["a"]},instanced:{point:new s["c"]([-.5,-.5,-.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5])},preDrawHook:function(){return"gl.enable(gl.DEPTH_TEST);\n        gl.depthFunc(gl.LEQUAL);"},postDrawHook:function(){return"gl.disable(gl.DEPTH_TEST);"}});return e.call(this,i)}return Object(c["a"])(n,[{key:"clear",value:function(){this.program.setCount(0)}}]),n}(s["b"]),v=n("00c7"),h=n.n(v),m=h()({}),g=m,y=n("25a5"),b=n.n(y),w=n("471e"),_=n.n(w),C=n("9469"),x=n.n(C),k={imageEndpoint:"https://anvaka.github.io/similar-cities-data/"},E=k;function j(t){var e,n,i,o,a,l,c=new b.a,d=4,u={getNodePosition:function(t){return e.getNode(t).data.position}};return fetch("distance.dot",{mode:"cors"}).then((function(t){return t.text()})).then((function(t){C(x()(t))})),{dispose:N,getDetails:m,showNode:h};function v(){a.clear(),l.clear()}function h(t,i){v();var o=e.getNode(t),s=Object(r["a"])({},o.ui);if(s.color=3206640383,s.size*=1.2,a.add(s),e.forEachLinkedNode(t,(function(t,e){var n=2431553791,i=Object(r["a"])({},t.ui);i.color=n,a.add(i);var o=Object(r["a"])({},e.ui);o.color=4294967295,l.add(o)})),i){var c=o.data,d=c.x,u=c.y,f=20;n.setViewBox({left:d-f,top:u-f,right:d+f,bottom:u+f})}n.renderFrame()}function m(t){var n=[];return e.forEachLinkedNode(t,(function(t,e){var i=y(t.id);i.score=e.data.weight,n.push(i)})),n.sort((function(t,e){return e.score-t.score})),{main:y(t),related:n}}function y(t){var n=e.getNode(t);return{id:t,name:n.data.name,image:w(t)}}function w(t){return E.imageEndpoint+t+".png"}function C(t){n&&V(),n=k(),n.on("click",T),n.on("mousemove",P),e=t,window.graph=e,j(),O(),n.renderFrame(),g.fire("graph-ready",e)}function k(){var e=Object(s["d"])(t);e.setClearColor(12/255,41/255,82/255,1);var n=200;return e.setViewBox({left:-n,top:-n,right:n,bottom:n}),e}function j(){i=new p(n.getGL(),{capacity:e.getNodesCount()}),e.forEachNode((function(t){var e=d;t.data&&t.data.size?e=t.data.size:(t.data||(t.data={}),t.data.size=e);var n=t.data,o=n.x,a=n.y;t.data.position=[o,a,0],t.ui={size:e,position:t.data.position,color:t.data.color||2432236799},t.uiId=i.add(t.ui)})),o=new f(n.getGL(),{capacity:e.getLinksCount()}),a=new p(n.getGL()),l=new f(n.getGL(),{width:6}),e.forEachLink((function(t){var e=u.getNodePosition(t.fromId),n=u.getNodePosition(t.toId),i={from:e,to:n,color:4294967072};t.ui=i,t.uiId=o.add(t.ui)})),n.appendChild(o),n.appendChild(i),n.appendChild(l),n.appendChild(a)}function O(){c.clear(),e.forEachNode((function(t){var e=t.data,n=e.x,i=e.y;c.insert({minX:n-d,minY:i-d,maxX:n+d,maxY:i+d,point:t.data,id:t.id})}))}function T(t){var e=L(t.x,t.y);void 0!==e&&g.fire("focus-node",e)}function P(t){var e=L(t.x,t.y);void 0===e?g.fire("show-tooltip",null):g.fire("show-tooltip",{x:t.originalEvent.clientX,y:t.originalEvent.clientY,data:e})}function L(t,e){var n=_()(c,t,e,1),i=n[0];if(void 0!==i){var o=i.point,a=Math.hypot(t-o.x,e-o.y);return a<d/2?i.id:void 0}}function N(){n&&n.dispose(),g.off("load-graph",C)}function V(){n.off("click",T),n.off("mousemove",P),n.dispose(),n=null}}var O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("img",{attrs:{src:t.src,alt:"city screenshot"}})])},T=[],P={props:["data"],data:function(){return{src:E.imageEndpoint+this.data.data+".png"}},methods:{}},L=P,N=n("2877"),V=Object(N["a"])(L,O,T,!1,null,null,null),D=V.exports,z=n("89c1"),B=n.n(z),S=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a",{staticClass:"city-name",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.focusNode()}}},[t._v(t._s(t.source.name))])},H=[],F=(n("a9e3"),{name:"city-name",props:{index:{type:Number},source:{type:Object,default:function(){return{}}}},methods:{focusNode:function(){g.fire("focus-node",this.source.id,!0)}}}),I=F,$=Object(N["a"])(I,S,H,!1,null,null,null),M=$.exports,G={name:"app",components:{Tooltip:D,VirtualList:B.a},data:function(){return{itemComponent:M,filterValue:"",tooltip:null,details:null,loaded:!1,listVisible:!1,nodes:[]}},computed:{listToggleHeader:function(){return this.listVisible?"Hide city list":"Show city list"},goBackHeader:function(){return"Close"},filteredNodes:function(){var t=this.filterValue,e=new RegExp(t,"i");return this.nodes.filter((function(n){return!t||n.name.match(e)}))}},methods:{showTooltip:function(t){var e=this;t?(clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout((function(){var n=window.innerWidth,i=window.innerHeight,o=i>900?800:.5*i;t.y<o&&(t.y+=o-t.y),t.x+o>n&&(t.x-=o),t.x<0&&(t.x=0),e.tooltip=t}),150)):this.hideTooltip()},showPanel:function(t){this.loaded=!0;var e=[];t.forEachNode((function(t){e.push({name:t.data.name,id:t.id})}));var n=this.nodes;e.sort((function(t,e){return t.name.localeCompare(e.name)})).forEach((function(t){return n.push(t)}))},showDetails:function(t,e){this.details=this.scene.getDetails(t),this.hideTooltip(),this.scene.showNode(t,e)},hideTooltip:function(){this.tooltip=null,clearTimeout(this.tooltipTimeout)},handleImageClick:function(t,e){e.ctrlKey||e.metaKey||(e.preventDefault(),this.showDetails(t,!0))},getLink:function(t){var e=this.scene.getDetails(t);return"https://anvaka.github.io/city-roads/?areaId=".concat(t,"&q=").concat(e.main.name)}},mounted:function(){var t=document.getElementById("cnv");this.scene=j(t),g.on("show-tooltip",this.showTooltip),g.on("graph-ready",this.showPanel),g.on("focus-node",this.showDetails)},beforeDestroy:function(){this.scene&&this.scene.dispose(),g.off("show-tooltip",this.showTooltip),g.off("graph-ready",this.showPanel),g.off("focus-node",this.showDetails)}},J=G,A=(n("034f"),Object(N["a"])(J,o,a,!1,null,null,null)),X=A.exports;function Y(t,e){return t.addEventListener("drop",o,!0),t.addEventListener("dragover",a),t.addEventListener("dragenter",i),t.addEventListener("dragleave",s),t.addEventListener("dragend",s),{dispose:n};function n(){t.removeEventListener("drop",o),t.removeEventListener("dragover",a),t.removeEventListener("dragenter",i),t.removeEventListener("dragleave",s),t.removeEventListener("dragend",s)}function i(t){r(t)&&t.preventDefault()}function o(t){s(),t.preventDefault();var n,i,o=t.dataTransfer,a=[];if(o.items)for(n=0;n<o.items.length;n++)"file"==o.items[n].kind&&(i=o.items[n].getAsFile(),a.push(i));else for(n=0;n<o.files.length;n++)i=o.files[n],a.push(i);e(a)}function a(e){r(e)&&(e.preventDefault(),t.classList.add("drag-over"))}function r(t){if(!t.dataTransfer)return!1;if(t.dataTransfer.files&&t.dataTransfer.files.length>0)return!0;var e=t.dataTransfer.items;if(!e)return!1;for(var n=0;n<e.length;++n)if("file"===e[n].kind)return!0;return!1}function s(){t.classList.remove("drag-over")}}var K=n("8392"),R=n.n(K);function U(t){var e=t[0],n=new FileReader;function i(t){try{return x()(t)}catch(e){console.log("error loading dot file: ",e)}}function o(t){try{return R()(JSON.parse(t))}catch(e){console.log("error loading JSON: ",e)}}n.readAsText(e,"UTF-8"),n.onload=function(t){var e=t.target.result,n=i(e)||o(e);n&&g.fire("load-graph",n)},n.onerror=function(t){console.log("error loading dot file: ",t)}}i["default"].config.productionTip=!1,new i["default"]({render:function(t){return t(X)}}).$mount("#app"),Y(document.body,U)},"85ec":function(t,e,n){}});
//# sourceMappingURL=app.c580ded0.js.map